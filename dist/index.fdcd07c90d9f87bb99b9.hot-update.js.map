{"version":3,"sources":["webpack:///./client/User/containers/Home/index.jsx"],"names":["get_latest_list","Home","mapStateToProps","mapDispatchToProps","props","loadMoreHandle","bind","debounce","window","feature","isSupport","set","maxAge","domain","$scrollWrap","div","data","map","item","id","isEndPage","$loadmore","area","sHeight","screen","height","top","getBoundingClientRect","pageNum","perPage","length","addEventListener","removeEventListener","defaultProps","totalCount","propTypes","arrayOf","object","isRequired","number","bool","state","latestReducer","dispatch"],"mappings":"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","file":"index.fdcd07c90d9f87bb99b9.hot-update.js","sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport { bindActionCreators } from 'redux'\nimport { connect } from 'react-redux'\n\nimport Popup from '../../components/Popup'\nimport { LatestItem } from '../../components/HomeList/index'\nimport Header from '../../components/Header'\nimport Bg from '../../components/Bg'\nimport Nav from '../../components/Nav'\nimport LoadMore from '../../components/LoadMore'\nimport { actions } from '../../redux/reducers/ArticleList'\nimport debounce from '../../../lib/debounce'\nimport detectWebp from '../../../lib/detectWebp'\nimport { Cookies } from '../../../lib/cookie'\n\nimport './index.css'\n\nconst { get_latest_list } = actions\n\n// === 生命周期: === //\n// === 1 挂载或卸载: === //\n// === 1.1 constructor(props): 初始化组件, 绑定函数到this === //\n// === 1.2 componentWillMount(): 挂载前 === //\n// === 1.3 render(): 将虚拟dom插到到真实dom === //\n// === 1.4 componentDidMount(): 挂载后, 进行异步请求等 === //\n// === 1.5 componentWillUnMount(): 卸载前,  === //\n// === 2 更新: === //\n// === 2.1 componentWillReceiveProps(nextProps) === //\n// === 2.2 shouldComponentUpdate(nextProps, nextState): 判断是否应该更新 === //\n// === 2.3 componentWillUpdate(nextProps, nextState): 更新前 === //\n// === 2.4 render(): 将虚拟dom中改变了的反映到真实dom === //\n// === 2.5 componentDidUpdate(): 更新后 === //\n\n// === 装饰器: === //\n// ===  === //\n\n@connect(mapStateToProps, mapDispatchToProps)\nexport default class Home extends Component {\n  \n  constructor (props) {\n    super(props)\n\n    this.loadMoreHandle = this.loadMoreHandle.bind(this)\n    this.debounce = null\n\n  }\n  \n  // === 提供默认值，当父组件没有提供相应的props时就使用此 === //\n  static defaultProps = {\n    data: [{}],\n    pageNum: 0,\n    perPage: 10,\n    totalCount: 10,\n    isEndPage: false\n  }\n\n  componentWillMount () {\n\n    this.debounce = debounce(this.loadMoreHandle, 100).bind(this)\n\n    if (typeof window !== 'undefined') {\n\n      detectWebp('alpha', function (feature, isSupport) {\n\n        // === 二级域名cookie共享： === //\n        // === cookie只能读写大于等于自己的域，因此同一级域名间的cookie共享需要将cookie设置到更高的域中 === //\n        if (isSupport) {\n          Cookies.set('supportWebp', true, {\n            maxAge: 60 * 60 * 24 * 7,\n            domain: '.hellojm.cn'\n          })\n        } else {\n          Cookies.set('supportWebp', false, {\n            domain: '.hellojm.cn'\n          })\n        }\n\n      })\n\n    }\n\n  }\n\n  render () {\n    return (\n      <div className='home-page'>\n        <Bg/>\n        <Header/>\n        <main className=\"main\">\n          <Nav/>\n          <div className=\"latest-article-block nav-details-item\">\n            <div className=\"nav-details-inner\" ref={div => this.$scrollWrap = div}>\n              <ul className=\"article-list latest--list\">\n                {\n                  this.props.data.map(item => (\n                    <LatestItem {...item} key={item.id} />\n                  ))\n                }\n                <LoadMore\n                  isEndPage={this.props.isEndPage}\n                  loadMoreRef={area => this.$loadmore = area}\n                />\n              </ul>\n            </div>\n          </div>\n        </main>\n        <Popup />\n      </div>\n    )\n  }\n  \n  /**\n   * 加载更多\n   * // === 判断条件：以底部的下拉提示框为目标，判断它 距离可视区顶部的距离(getBoundingClientRect().top()) 以及 可视区高度，若小于则证明出现在了可视区，此时应该去请求数据 === //\n   */\n  loadMoreHandle () {\n\n    const sHeight = window.screen.height\n    const top = this.$loadmore.getBoundingClientRect().top\n\n    if (top < sHeight && !this.props.isEndPage) {\n      this.props.get_latest_list(this.props.pageNum + 1, this.props.perPage)\n    }\n\n  }\n\n  componentDidMount () {\n\n    // 第一页的数据\n    if (this.props.data.length === 0) {\n      this.props.get_latest_list(0, 10)\n    }\n    this.$scrollWrap.addEventListener('scroll', this.debounce, false)\n\n  }\n\n  componentWillUnmount () {\n\n    this.$scrollWrap.removeEventListener('scroll', this.debounce, false)\n    this.debounce = null\n\n  }\n}\n\n// === propTypes 会在 defaultProps 之后执行，因此对 defaultProps 也会检查 === //\nif (process.env.NODE_ENV === 'development') {\n  Home.propTypes = {\n    data: PropTypes.arrayOf(PropTypes.object).isRequired,\n    pageNum: PropTypes.number.isRequired,\n    perPage: PropTypes.number.isRequired,\n    totalCount: PropTypes.number.isRequired,\n    isEndPage: PropTypes.bool.isRequired\n  }\n}\n\nfunction mapStateToProps (state) {\n  return state.latestReducer\n}\n\nfunction mapDispatchToProps (dispatch) {\n  return {\n    get_latest_list: bindActionCreators(get_latest_list, dispatch)\n  }\n}\n"],"sourceRoot":""}